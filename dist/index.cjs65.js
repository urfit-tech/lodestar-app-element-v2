"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const I=require("./index.cjs67.js"),L=require("./index.cjs68.js"),N=require("./index.cjs69.js"),W=require("./index.cjs64.js"),Y=require("./index.cjs85.js"),J=require("./index.cjs86.js"),M=require("./index.cjs87.js"),U=require("./index.cjs84.js"),V=require("./index.cjs88.js");var v,b;function C(){if(b)return v;b=1;const n=I.__require(),j=L.__require(),_=N.__require(),q=W.__require(),A=Y.__require(),T=J.__require(),E=M.__require(),k=U.__require(),{KeyObject:R,createSecretKey:$,createPublicKey:B}=V.default,l=["RS256","RS384","RS512"],D=["ES256","ES384","ES512"],m=["RS256","RS384","RS512"],H=["HS256","HS384","HS512"];return E&&(l.splice(l.length,0,"PS256","PS384","PS512"),m.splice(m.length,0,"PS256","PS384","PS512")),v=function(f,o,e,d){typeof e=="function"&&!d&&(d=e,e={}),e||(e={}),e=Object.assign({},e);let r;if(d?r=d:r=function(u,t){if(u)throw u;return t},e.clockTimestamp&&typeof e.clockTimestamp!="number")return r(new n("clockTimestamp must be a number"));if(e.nonce!==void 0&&(typeof e.nonce!="string"||e.nonce.trim()===""))return r(new n("nonce must be a non-empty string"));if(e.allowInvalidAsymmetricKeyTypes!==void 0&&typeof e.allowInvalidAsymmetricKeyTypes!="boolean")return r(new n("allowInvalidAsymmetricKeyTypes must be a boolean"));const y=e.clockTimestamp||Math.floor(Date.now()/1e3);if(!f)return r(new n("jwt must be provided"));if(typeof f!="string")return r(new n("jwt must be a string"));const S=f.split(".");if(S.length!==3)return r(new n("jwt malformed"));let s;try{s=q(f,{complete:!0})}catch(u){return r(u)}if(!s)return r(new n("invalid token"));const c=s.header;let w;if(typeof o=="function"){if(!d)return r(new n("verify must be called asynchronous if secret or public key is provided as a callback"));w=o}else w=function(u,t){return t(null,o)};return w(c,function(u,t){if(u)return r(new n("error in secret or public key callback: "+u.message));const g=S[2].trim()!=="";if(!g&&t)return r(new n("jwt signature is required"));if(g&&!t)return r(new n("secret or public key must be provided"));if(!g&&!e.algorithms)return r(new n('please specify "none" in "algorithms" to verify unsigned tokens'));if(t!=null&&!(t instanceof R))try{t=B(t)}catch{try{t=$(typeof t=="string"?Buffer.from(t):t)}catch{return r(new n("secretOrPublicKey is not valid key material"))}}if(e.algorithms||(t.type==="secret"?e.algorithms=H:["rsa","rsa-pss"].includes(t.asymmetricKeyType)?e.algorithms=m:t.asymmetricKeyType==="ec"?e.algorithms=D:e.algorithms=l),e.algorithms.indexOf(s.header.alg)===-1)return r(new n("invalid algorithm"));if(c.alg.startsWith("HS")&&t.type!=="secret")return r(new n(`secretOrPublicKey must be a symmetric key when using ${c.alg}`));if(/^(?:RS|PS|ES)/.test(c.alg)&&t.type!=="public")return r(new n(`secretOrPublicKey must be an asymmetric key when using ${c.alg}`));if(!e.allowInvalidAsymmetricKeyTypes)try{T(c.alg,t)}catch(a){return r(a)}let x;try{x=k.verify(f,s.header.alg,t)}catch(a){return r(a)}if(!x)return r(new n("invalid signature"));const i=s.payload;if(typeof i.nbf<"u"&&!e.ignoreNotBefore){if(typeof i.nbf!="number")return r(new n("invalid nbf value"));if(i.nbf>y+(e.clockTolerance||0))return r(new j("jwt not active",new Date(i.nbf*1e3)))}if(typeof i.exp<"u"&&!e.ignoreExpiration){if(typeof i.exp!="number")return r(new n("invalid exp value"));if(y>=i.exp+(e.clockTolerance||0))return r(new _("jwt expired",new Date(i.exp*1e3)))}if(e.audience){const a=Array.isArray(e.audience)?e.audience:[e.audience];if(!(Array.isArray(i.aud)?i.aud:[i.aud]).some(function(p){return a.some(function(h){return h instanceof RegExp?h.test(p):h===p})}))return r(new n("jwt audience invalid. expected: "+a.join(" or ")))}if(e.issuer&&(typeof e.issuer=="string"&&i.iss!==e.issuer||Array.isArray(e.issuer)&&e.issuer.indexOf(i.iss)===-1))return r(new n("jwt issuer invalid. expected: "+e.issuer));if(e.subject&&i.sub!==e.subject)return r(new n("jwt subject invalid. expected: "+e.subject));if(e.jwtid&&i.jti!==e.jwtid)return r(new n("jwt jwtid invalid. expected: "+e.jwtid));if(e.nonce&&i.nonce!==e.nonce)return r(new n("jwt nonce invalid. expected: "+e.nonce));if(e.maxAge){if(typeof i.iat!="number")return r(new n("iat required when maxAge is specified"));const a=A(e.maxAge,i.iat);if(typeof a>"u")return r(new n('"maxAge" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'));if(y>=a+(e.clockTolerance||0))return r(new _("maxAge exceeded",new Date(a*1e3)))}if(e.complete===!0){const a=s.signature;return r(null,{header:c,payload:i,signature:a})}return r(null,i)})},v}exports.__require=C;
//# sourceMappingURL=index.cjs65.js.map
