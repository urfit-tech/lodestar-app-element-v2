{"version":3,"file":"index.cjs11.js","sources":["../src/helpers/index.ts"],"sourcesContent":["import axios, { AxiosRequestConfig } from 'axios'\nimport dayjs from 'dayjs'\nimport Cookies from 'js-cookie'\nimport queryString from 'query-string'\nimport { css } from 'styled-components'\nimport { BREAK_POINT } from '../components/common/Responsive'\nimport { ContactInfo } from '../types/checkout'\nimport { ProductPlan } from '../types/data'\nimport {\n  BindDeviceError,\n  InputError,\n  LoginDeviceError,\n  NoMemberError,\n  NoModuleError,\n  PasswordError,\n  SendEmailError,\n  SessionError,\n} from './error'\n\nexport const durationFullFormatter = (seconds: number) => {\n  if (seconds >= 3600) {\n    const remainSeconds = seconds % 3600\n    return `HOURS:MINUTES:SECONDS`\n      .replace('HOURS', `${Math.floor(seconds / 3600)}`.padStart(2, '0'))\n      .replace('MINUTES', `${Math.floor(remainSeconds / 60)}`.padStart(2, '0'))\n      .replace('SECONDS', `${Math.floor(remainSeconds % 60)}`.padStart(2, '0'))\n  } else {\n    return `MINUTES:SECONDS`\n      .replace('MINUTES', `${Math.floor(seconds / 60)}`.padStart(2, '0'))\n      .replace('SECONDS', `${Math.floor(seconds % 60)}`.padStart(2, '0'))\n  }\n}\n\nexport const durationFormatter = (value?: number | null) => {\n  return typeof value === 'number' && `約 ${(value / 60).toFixed(0)} 分鐘`\n}\n\nexport const uploadFile = async (\n  key: string,\n  file: Blob,\n  authToken: string | null,\n  envApiBaseRoot: string,\n  config?: AxiosRequestConfig,\n) =>\n  await axios\n    .post(\n      `${envApiBaseRoot}/sys/sign-url`,\n      {\n        operation: 'putObject',\n        params: {\n          Key: key,\n          ContentType: file.type,\n        },\n      },\n      {\n        headers: { authorization: `Bearer ${authToken}` },\n      },\n    )\n    .then(res => res.data.result)\n    .then(url => {\n      const { query } = queryString.parseUrl(url)\n      return axios.put<{ status: number; data: string }>(url, file, {\n        ...config,\n        headers: {\n          ...query,\n          'Content-Type': file.type,\n        },\n      })\n    })\n\nexport const handleError = (error: any) => {\n  if (error.response && error.response.data) {\n    return alert(error.response.data.message)\n  }\n  return alert(error.message)\n}\n\nexport const notEmpty = <T>(value: T | null | undefined): value is T => {\n  return value !== null && value !== undefined\n}\n\nexport const rgba = (hexCode: string, alpha: number) => {\n  const hexColor = (hexCode || '#2d313a').replace('#', '')\n  const r = parseInt(hexColor.slice(0, 2), 16)\n  const g = parseInt(hexColor.slice(2, 4), 16)\n  const b = parseInt(hexColor.slice(4, 6), 16)\n  return `rgba(${r}, ${g}, ${b}, ${alpha})`\n}\n\nexport const dateFormatter = (value: Date, format?: string) => dayjs(value).format(format || `YYYY/MM/DD HH:mm`)\n\nexport const getCurrentPrice = (plan: Partial<ProductPlan>) =>\n  (plan.soldAt && dayjs() < dayjs(plan.soldAt) ? plan.salePrice : plan.listPrice) || 0\n\nexport const findCheapestPlan = (plans: Partial<ProductPlan>[]) =>\n  plans\n    .filter(plan => plan.publishedAt !== null)\n    .reduce(\n      (accum, plan) => (accum === null ? plan : getCurrentPrice(plan) < getCurrentPrice(accum) ? plan : accum),\n      null as Partial<ProductPlan> | null,\n    )\n\nexport const desktopViewMixin = (children: ReturnType<typeof css>): ReturnType<typeof css> => css`\n  @media (min-width: ${BREAK_POINT}px) {\n    ${children}\n  }\n`\n\nexport const validationRegExp: { [fieldId: string]: RegExp } = {\n  phone:\n    /^((?:\\+|00)[17](?: |-)?|(?:\\+|00)[1-9]\\d{0,2}(?: |-)?|(?:\\+|00)1-\\d{3}(?: |-)?)?(0\\d|\\([0-9]{3}\\)|[1-9]{0,3})(?:((?: |-)[0-9]{2}){4}|((?:[0-9]{2}){4})|((?: |-)[0-9]{3}(?: |-)[0-9]{4})|([0-9]{7}))$/,\n  email:\n    /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/,\n  phoneBarCode: /^\\/{1}[0-9A-Z+-.]{7}$/,\n  citizenCode: /^[A-Z]{2}[0-9]{14}$/,\n}\n\nexport const validateContactInfo: (contactInfo: ContactInfo) => string[] = contactInfo => {\n  const errorFields: string[] = []\n  if (contactInfo.name.length === 0) errorFields.push('name')\n  if (contactInfo.phone.length === 0 || !validationRegExp['phone']?.test(contactInfo.phone)) {\n    errorFields.push('phone')\n  }\n  if (contactInfo.email.length === 0 || !validationRegExp['email']?.test(contactInfo.email)) {\n    errorFields.push('email')\n  }\n  return errorFields\n}\n\nexport const convertPathName = (pathName: string) => {\n  const pathList = pathName.split('/').filter(p => p !== '')\n  return pathList.join('_') || '_'\n}\n\nexport const isHTMLString = (str: string) =>\n  !(str || '')\n    // replace html tag with content\n    .replace(/<([^>]+?)([^>]*?)>(.*?)<\\/\\1>/gi, '')\n    // remove remaining self closing tags\n    .replace(/(<([^>]+)>)/gi, '')\n    // remove extra space at start and end\n    .trim()\n\nexport function zipWith<T, R>(a1: T[], a2: T[], f: (v1: T, v2: T) => R): R[] {\n  const length = Math.min(a1.length, a2.length)\n  const result: R[] = []\n\n  for (let i = 0; i < length; i++) result[i] = f(a1[i], a2[i])\n\n  return result\n}\n\nexport function add(a: number, b: number) {\n  return a + b\n}\n\nexport function multiply(a: number, b: number) {\n  return a * b\n}\n\nexport type BanValidationOptions = {\n  /**\n   * validate `input` with old format only: https://www.fia.gov.tw/singlehtml/3?cntId=c4d9cff38c8642ef8872774ee9987283\n   */\n  applyOldRules?: boolean\n}\n\nexport const checkUniformNumber = (input: string | number, options: BanValidationOptions = {}) => {\n  const { applyOldRules = false } = options\n\n  if (typeof input !== 'string' && typeof input !== 'number') return false\n\n  /**\n   * Example: 12345675\n   * Step 1:\n   * 1 * 1 = 1\n   * 2 * 2 = 4\n   * 3 * 1 = 3\n   * 4 * 2 = 8\n   * 5 * 1 = 5\n   * 6 * 2 = 12\n   * 7 * 4 = 28\n   * 5 * 1 = 5\n   *\n   * Step 2:\n   * 1 -> 1\n   * 4 -> 4\n   * 3 -> 3\n   * 8 -> 8\n   * 5 -> 5\n   * 12 -> 1 + 2 = 3\n   * 28 -> 2 + 8 = 10\n   * 5 -> 5\n   *\n   * Step 3:\n   * (1 + 4 + 3 + 8 + 5 + 3 + 10 + 5) % 10 = 9\n   */\n\n  const BAN_COEFFICIENTS = [1, 2, 1, 2, 1, 2, 4, 1]\n\n  const n = input.toString()\n  const regex = /^\\d{8}$/\n\n  if (!regex.test(n)) return false\n\n  /**\n   * Step 1: 先把統一編號的每個數字分別乘上對應的係數 (1, 2, 1, 2, 1, 2, 4, 1)\n   * Step 2: 再把個別乘積的十位數與個位數相加，得出八個小於 10 的數字\n   */\n\n  const intRadix = 10\n  const checksum = zipWith(\n    BAN_COEFFICIENTS,\n    n.split('').map(c => parseInt(c, intRadix)),\n    multiply,\n  )\n    .map(n => (n % 10) + Math.floor(n / 10))\n    .reduce(add, 0)\n\n  /**\n   * Step 3: 檢查把這 8 個數字相加之後計算此和除以 5 or 10 的餘數\n   * Step 4:\n   *  4-1: 若是餘數為 0，則為正確的統一編號\n   *  4-2: 若是餘數為 9，且原統一編號的第七位是 7，則也為正確的統一編號\n   */\n\n  const divisor = applyOldRules ? 10 : 5\n\n  return checksum % divisor === 0 || (parseInt(n.charAt(6), intRadix) === 7 && (checksum + 1) % divisor === 0)\n}\n\nexport const getBackendServerError = (code: string, message: string, result: string) => {\n  let errorObject: Error\n  switch (code) {\n    case 'E_INPUT':\n      errorObject = new InputError(message, result)\n      break\n    case 'E_SESSION':\n      errorObject = new SessionError(message, result)\n      break\n    case 'E_NO_MODULE':\n      errorObject = new NoModuleError(message, result)\n      break\n    case 'E_SEND_EMAIL':\n      errorObject = new SendEmailError(message, result)\n      break\n    case 'E_PASSWORD':\n      errorObject = new PasswordError(message, result)\n      break\n    case 'E_NO_MEMBER':\n      errorObject = new NoMemberError(message, result)\n      break\n    case 'E_BIND_DEVICE':\n      errorObject = new BindDeviceError(message, result)\n      break\n    case 'E_LOGIN_DEVICE':\n      errorObject = new LoginDeviceError(message, result)\n      break\n    default:\n      errorObject = new Error(message)\n  }\n  return errorObject\n}\n\nexport const getTrackingCookie = () => {\n  const fbc = Cookies.get('_fbc') // dmpId\n  const fbp = Cookies.get('_fbp') // dmpId\n  const dmpId = Cookies.get('__eruid') // dmpId\n  let utm = Cookies.get('utm')\n  utm = utm ? JSON.parse(utm) : null\n  const trackingCookie = {}\n  if (utm) Object.assign(trackingCookie, { utm })\n  if (dmpId) Object.assign(trackingCookie, { dmpId })\n  if (fbc) Object.assign(trackingCookie, { fbc })\n  if (fbp) Object.assign(trackingCookie, { fbp })\n  return trackingCookie\n}\n\nexport const currencyFormatter = (value?: number | string | null, currencyId?: string, coinUnit?: string) => {\n  if (value === null || value === undefined) {\n    return\n  } else if (currencyId === 'LSC') {\n    return `${value} ${coinUnit || currencyId}`\n  } else {\n    return `NT$ ${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')\n  }\n}\n"],"names":["durationFullFormatter","seconds","remainSeconds","durationFormatter","value","uploadFile","key","file","authToken","envApiBaseRoot","config","axios","res","url","query","queryString","handleError","error","notEmpty","rgba","hexCode","alpha","hexColor","r","g","b","dateFormatter","format","dayjs","getCurrentPrice","plan","findCheapestPlan","plans","accum","desktopViewMixin","children","css","BREAK_POINT","validationRegExp","validateContactInfo","contactInfo","errorFields","convertPathName","pathName","p","isHTMLString","str","zipWith","a1","a2","f","length","result","i","add","a","multiply","checkUniformNumber","input","options","applyOldRules","BAN_COEFFICIENTS","n","intRadix","checksum","divisor","getBackendServerError","code","message","errorObject","InputError","SessionError","NoModuleError","SendEmailError","PasswordError","NoMemberError","BindDeviceError","LoginDeviceError","getTrackingCookie","fbc","Cookies","fbp","dmpId","utm","trackingCookie","currencyFormatter","currencyId","coinUnit"],"mappings":"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"}