{"version":3,"file":"index.es11.js","sources":["../src/helpers/index.ts"],"sourcesContent":["import axios, { AxiosRequestConfig } from 'axios'\nimport dayjs from 'dayjs'\nimport Cookies from 'js-cookie'\nimport queryString from 'query-string'\nimport { css } from 'styled-components'\nimport { BREAK_POINT } from '../components/common/Responsive'\nimport { ContactInfo } from '../types/checkout'\nimport { ProductPlan } from '../types/data'\nimport {\n  BindDeviceError,\n  InputError,\n  LoginDeviceError,\n  NoMemberError,\n  NoModuleError,\n  PasswordError,\n  SendEmailError,\n  SessionError,\n} from './error'\n\nexport const durationFullFormatter = (seconds: number) => {\n  if (seconds >= 3600) {\n    const remainSeconds = seconds % 3600\n    return `HOURS:MINUTES:SECONDS`\n      .replace('HOURS', `${Math.floor(seconds / 3600)}`.padStart(2, '0'))\n      .replace('MINUTES', `${Math.floor(remainSeconds / 60)}`.padStart(2, '0'))\n      .replace('SECONDS', `${Math.floor(remainSeconds % 60)}`.padStart(2, '0'))\n  } else {\n    return `MINUTES:SECONDS`\n      .replace('MINUTES', `${Math.floor(seconds / 60)}`.padStart(2, '0'))\n      .replace('SECONDS', `${Math.floor(seconds % 60)}`.padStart(2, '0'))\n  }\n}\n\nexport const durationFormatter = (value?: number | null) => {\n  return typeof value === 'number' && `約 ${(value / 60).toFixed(0)} 分鐘`\n}\n\nexport const uploadFile = async (\n  key: string,\n  file: Blob,\n  authToken: string | null,\n  envApiBaseRoot: string,\n  config?: AxiosRequestConfig,\n) =>\n  await axios\n    .post(\n      `${envApiBaseRoot}/sys/sign-url`,\n      {\n        operation: 'putObject',\n        params: {\n          Key: key,\n          ContentType: file.type,\n        },\n      },\n      {\n        headers: { authorization: `Bearer ${authToken}` },\n      },\n    )\n    .then(res => res.data.result)\n    .then(url => {\n      const { query } = queryString.parseUrl(url)\n      return axios.put<{ status: number; data: string }>(url, file, {\n        ...config,\n        headers: {\n          ...query,\n          'Content-Type': file.type,\n        },\n      })\n    })\n\nexport const handleError = (error: any) => {\n  if (error.response && error.response.data) {\n    return alert(error.response.data.message)\n  }\n  return alert(error.message)\n}\n\nexport const notEmpty = <T>(value: T | null | undefined): value is T => {\n  return value !== null && value !== undefined\n}\n\nexport const rgba = (hexCode: string, alpha: number) => {\n  const hexColor = (hexCode || '#2d313a').replace('#', '')\n  const r = parseInt(hexColor.slice(0, 2), 16)\n  const g = parseInt(hexColor.slice(2, 4), 16)\n  const b = parseInt(hexColor.slice(4, 6), 16)\n  return `rgba(${r}, ${g}, ${b}, ${alpha})`\n}\n\nexport const dateFormatter = (value: Date, format?: string) => dayjs(value).format(format || `YYYY/MM/DD HH:mm`)\n\nexport const getCurrentPrice = (plan: Partial<ProductPlan>) =>\n  (plan.soldAt && dayjs() < dayjs(plan.soldAt) ? plan.salePrice : plan.listPrice) || 0\n\nexport const findCheapestPlan = (plans: Partial<ProductPlan>[]) =>\n  plans\n    .filter(plan => plan.publishedAt !== null)\n    .reduce(\n      (accum, plan) => (accum === null ? plan : getCurrentPrice(plan) < getCurrentPrice(accum) ? plan : accum),\n      null as Partial<ProductPlan> | null,\n    )\n\nexport const desktopViewMixin = (children: ReturnType<typeof css>): ReturnType<typeof css> => css`\n  @media (min-width: ${BREAK_POINT}px) {\n    ${children}\n  }\n`\n\nexport const validationRegExp: { [fieldId: string]: RegExp } = {\n  phone:\n    /^((?:\\+|00)[17](?: |-)?|(?:\\+|00)[1-9]\\d{0,2}(?: |-)?|(?:\\+|00)1-\\d{3}(?: |-)?)?(0\\d|\\([0-9]{3}\\)|[1-9]{0,3})(?:((?: |-)[0-9]{2}){4}|((?:[0-9]{2}){4})|((?: |-)[0-9]{3}(?: |-)[0-9]{4})|([0-9]{7}))$/,\n  email:\n    /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/,\n  phoneBarCode: /^\\/{1}[0-9A-Z+-.]{7}$/,\n  citizenCode: /^[A-Z]{2}[0-9]{14}$/,\n}\n\nexport const validateContactInfo: (contactInfo: ContactInfo) => string[] = contactInfo => {\n  const errorFields: string[] = []\n  if (contactInfo.name.length === 0) errorFields.push('name')\n  if (contactInfo.phone.length === 0 || !validationRegExp['phone']?.test(contactInfo.phone)) {\n    errorFields.push('phone')\n  }\n  if (contactInfo.email.length === 0 || !validationRegExp['email']?.test(contactInfo.email)) {\n    errorFields.push('email')\n  }\n  return errorFields\n}\n\nexport const convertPathName = (pathName: string) => {\n  const pathList = pathName.split('/').filter(p => p !== '')\n  return pathList.join('_') || '_'\n}\n\nexport const isHTMLString = (str: string) =>\n  !(str || '')\n    // replace html tag with content\n    .replace(/<([^>]+?)([^>]*?)>(.*?)<\\/\\1>/gi, '')\n    // remove remaining self closing tags\n    .replace(/(<([^>]+)>)/gi, '')\n    // remove extra space at start and end\n    .trim()\n\nexport function zipWith<T, R>(a1: T[], a2: T[], f: (v1: T, v2: T) => R): R[] {\n  const length = Math.min(a1.length, a2.length)\n  const result: R[] = []\n\n  for (let i = 0; i < length; i++) result[i] = f(a1[i], a2[i])\n\n  return result\n}\n\nexport function add(a: number, b: number) {\n  return a + b\n}\n\nexport function multiply(a: number, b: number) {\n  return a * b\n}\n\nexport type BanValidationOptions = {\n  /**\n   * validate `input` with old format only: https://www.fia.gov.tw/singlehtml/3?cntId=c4d9cff38c8642ef8872774ee9987283\n   */\n  applyOldRules?: boolean\n}\n\nexport const checkUniformNumber = (input: string | number, options: BanValidationOptions = {}) => {\n  const { applyOldRules = false } = options\n\n  if (typeof input !== 'string' && typeof input !== 'number') return false\n\n  /**\n   * Example: 12345675\n   * Step 1:\n   * 1 * 1 = 1\n   * 2 * 2 = 4\n   * 3 * 1 = 3\n   * 4 * 2 = 8\n   * 5 * 1 = 5\n   * 6 * 2 = 12\n   * 7 * 4 = 28\n   * 5 * 1 = 5\n   *\n   * Step 2:\n   * 1 -> 1\n   * 4 -> 4\n   * 3 -> 3\n   * 8 -> 8\n   * 5 -> 5\n   * 12 -> 1 + 2 = 3\n   * 28 -> 2 + 8 = 10\n   * 5 -> 5\n   *\n   * Step 3:\n   * (1 + 4 + 3 + 8 + 5 + 3 + 10 + 5) % 10 = 9\n   */\n\n  const BAN_COEFFICIENTS = [1, 2, 1, 2, 1, 2, 4, 1]\n\n  const n = input.toString()\n  const regex = /^\\d{8}$/\n\n  if (!regex.test(n)) return false\n\n  /**\n   * Step 1: 先把統一編號的每個數字分別乘上對應的係數 (1, 2, 1, 2, 1, 2, 4, 1)\n   * Step 2: 再把個別乘積的十位數與個位數相加，得出八個小於 10 的數字\n   */\n\n  const intRadix = 10\n  const checksum = zipWith(\n    BAN_COEFFICIENTS,\n    n.split('').map(c => parseInt(c, intRadix)),\n    multiply,\n  )\n    .map(n => (n % 10) + Math.floor(n / 10))\n    .reduce(add, 0)\n\n  /**\n   * Step 3: 檢查把這 8 個數字相加之後計算此和除以 5 or 10 的餘數\n   * Step 4:\n   *  4-1: 若是餘數為 0，則為正確的統一編號\n   *  4-2: 若是餘數為 9，且原統一編號的第七位是 7，則也為正確的統一編號\n   */\n\n  const divisor = applyOldRules ? 10 : 5\n\n  return checksum % divisor === 0 || (parseInt(n.charAt(6), intRadix) === 7 && (checksum + 1) % divisor === 0)\n}\n\nexport const getBackendServerError = (code: string, message: string, result: string) => {\n  let errorObject: Error\n  switch (code) {\n    case 'E_INPUT':\n      errorObject = new InputError(message, result)\n      break\n    case 'E_SESSION':\n      errorObject = new SessionError(message, result)\n      break\n    case 'E_NO_MODULE':\n      errorObject = new NoModuleError(message, result)\n      break\n    case 'E_SEND_EMAIL':\n      errorObject = new SendEmailError(message, result)\n      break\n    case 'E_PASSWORD':\n      errorObject = new PasswordError(message, result)\n      break\n    case 'E_NO_MEMBER':\n      errorObject = new NoMemberError(message, result)\n      break\n    case 'E_BIND_DEVICE':\n      errorObject = new BindDeviceError(message, result)\n      break\n    case 'E_LOGIN_DEVICE':\n      errorObject = new LoginDeviceError(message, result)\n      break\n    default:\n      errorObject = new Error(message)\n  }\n  return errorObject\n}\n\nexport const getTrackingCookie = () => {\n  const fbc = Cookies.get('_fbc') // dmpId\n  const fbp = Cookies.get('_fbp') // dmpId\n  const dmpId = Cookies.get('__eruid') // dmpId\n  let utm = Cookies.get('utm')\n  utm = utm ? JSON.parse(utm) : null\n  const trackingCookie = {}\n  if (utm) Object.assign(trackingCookie, { utm })\n  if (dmpId) Object.assign(trackingCookie, { dmpId })\n  if (fbc) Object.assign(trackingCookie, { fbc })\n  if (fbp) Object.assign(trackingCookie, { fbp })\n  return trackingCookie\n}\n\nexport const currencyFormatter = (value?: number | string | null, currencyId?: string, coinUnit?: string) => {\n  if (value === null || value === undefined) {\n    return\n  } else if (currencyId === 'LSC') {\n    return `${value} ${coinUnit || currencyId}`\n  } else {\n    return `NT$ ${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')\n  }\n}\n"],"names":["durationFullFormatter","seconds","remainSeconds","durationFormatter","value","uploadFile","key","file","authToken","envApiBaseRoot","config","axios","res","url","query","queryString","handleError","error","notEmpty","rgba","hexCode","alpha","hexColor","r","g","b","dateFormatter","format","dayjs","getCurrentPrice","plan","findCheapestPlan","plans","accum","desktopViewMixin","children","css","BREAK_POINT","validationRegExp","validateContactInfo","contactInfo","errorFields","convertPathName","pathName","p","isHTMLString","str","zipWith","a1","a2","f","length","result","i","add","a","multiply","checkUniformNumber","input","options","applyOldRules","BAN_COEFFICIENTS","n","intRadix","checksum","c","divisor","getBackendServerError","code","message","errorObject","InputError","SessionError","NoModuleError","SendEmailError","PasswordError","NoMemberError","BindDeviceError","LoginDeviceError","getTrackingCookie","fbc","Cookies","fbp","dmpId","utm","trackingCookie","currencyFormatter","currencyId","coinUnit"],"mappings":"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"}