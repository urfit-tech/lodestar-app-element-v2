{"version":3,"file":"index.cjs126.js","sources":["../node_modules/jws/lib/sign-stream.js"],"sourcesContent":["/*global module*/\nvar Buffer = require('safe-buffer').Buffer;\nvar DataStream = require('./data-stream');\nvar jwa = require('jwa');\nvar Stream = require('stream');\nvar toString = require('./tostring');\nvar util = require('util');\n\nfunction base64url(string, encoding) {\n  return Buffer\n    .from(string, encoding)\n    .toString('base64')\n    .replace(/=/g, '')\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_');\n}\n\nfunction jwsSecuredInput(header, payload, encoding) {\n  encoding = encoding || 'utf8';\n  var encodedHeader = base64url(toString(header), 'binary');\n  var encodedPayload = base64url(toString(payload), encoding);\n  return util.format('%s.%s', encodedHeader, encodedPayload);\n}\n\nfunction jwsSign(opts) {\n  var header = opts.header;\n  var payload = opts.payload;\n  var secretOrKey = opts.secret || opts.privateKey;\n  var encoding = opts.encoding;\n  var algo = jwa(header.alg);\n  var securedInput = jwsSecuredInput(header, payload, encoding);\n  var signature = algo.sign(securedInput, secretOrKey);\n  return util.format('%s.%s', securedInput, signature);\n}\n\nfunction SignStream(opts) {\n  var secret = opts.secret||opts.privateKey||opts.key;\n  var secretStream = new DataStream(secret);\n  this.readable = true;\n  this.header = opts.header;\n  this.encoding = opts.encoding;\n  this.secret = this.privateKey = this.key = secretStream;\n  this.payload = new DataStream(opts.payload);\n  this.secret.once('close', function () {\n    if (!this.payload.writable && this.readable)\n      this.sign();\n  }.bind(this));\n\n  this.payload.once('close', function () {\n    if (!this.secret.writable && this.readable)\n      this.sign();\n  }.bind(this));\n}\nutil.inherits(SignStream, Stream);\n\nSignStream.prototype.sign = function sign() {\n  try {\n    var signature = jwsSign({\n      header: this.header,\n      payload: this.payload.buffer,\n      secret: this.secret.buffer,\n      encoding: this.encoding\n    });\n    this.emit('done', signature);\n    this.emit('data', signature);\n    this.emit('end');\n    this.readable = false;\n    return signature;\n  } catch (e) {\n    this.readable = false;\n    this.emit('error', e);\n    this.emit('close');\n  }\n};\n\nSignStream.sign = jwsSign;\n\nmodule.exports = SignStream;\n"],"names":["Buffer","require$$0","DataStream","require$$1","jwa","require$$2","Stream","require$$3","toString","require$$4","util","require$$5","base64url","string","encoding","jwsSecuredInput","header","payload","encodedHeader","encodedPayload","jwsSign","opts","secretOrKey","algo","securedInput","signature","SignStream","secret","secretStream","e","signStream"],"mappings":"sTACA,IAAIA,EAASC,EAAsB,UAAA,EAAC,OAChCC,EAAaC,EAAAA,UAAwB,EACrCC,EAAMC,EAAAA,UAAc,EACpBC,EAASC,EAAiB,QAC1BC,EAAWC,EAAAA,UAAqB,EAChCC,EAAOC,EAAAA,UAAe,EAE1B,SAASC,EAAUC,EAAQC,EAAU,CACnC,OAAOd,EACJ,KAAKa,EAAQC,CAAQ,EACrB,SAAS,QAAQ,EACjB,QAAQ,KAAM,EAAE,EAChB,QAAQ,MAAO,GAAG,EAClB,QAAQ,MAAO,GAAG,CACvB,CAEA,SAASC,EAAgBC,EAAQC,EAASH,EAAU,CAClDA,EAAWA,GAAY,OACvB,IAAII,EAAgBN,EAAUJ,EAASQ,CAAM,EAAG,QAAQ,EACpDG,EAAiBP,EAAUJ,EAASS,CAAO,EAAGH,CAAQ,EAC1D,OAAOJ,EAAK,OAAO,QAASQ,EAAeC,CAAc,CAC3D,CAEA,SAASC,EAAQC,EAAM,CACrB,IAAIL,EAASK,EAAK,OACdJ,EAAUI,EAAK,QACfC,EAAcD,EAAK,QAAUA,EAAK,WAClCP,EAAWO,EAAK,SAChBE,EAAOnB,EAAIY,EAAO,GAAG,EACrBQ,EAAeT,EAAgBC,EAAQC,EAASH,CAAQ,EACxDW,EAAYF,EAAK,KAAKC,EAAcF,CAAW,EACnD,OAAOZ,EAAK,OAAO,QAASc,EAAcC,CAAS,CACrD,CAEA,SAASC,EAAWL,EAAM,CACxB,IAAIM,EAASN,EAAK,QAAQA,EAAK,YAAYA,EAAK,IAC5CO,EAAe,IAAI1B,EAAWyB,CAAM,EACxC,KAAK,SAAW,GAChB,KAAK,OAASN,EAAK,OACnB,KAAK,SAAWA,EAAK,SACrB,KAAK,OAAS,KAAK,WAAa,KAAK,IAAMO,EAC3C,KAAK,QAAU,IAAI1B,EAAWmB,EAAK,OAAO,EAC1C,KAAK,OAAO,KAAK,QAAS,UAAY,CAChC,CAAC,KAAK,QAAQ,UAAY,KAAK,UACjC,KAAK,KAAM,CACjB,EAAI,KAAK,IAAI,CAAC,EAEZ,KAAK,QAAQ,KAAK,QAAS,UAAY,CACjC,CAAC,KAAK,OAAO,UAAY,KAAK,UAChC,KAAK,KAAM,CACjB,EAAI,KAAK,IAAI,CAAC,CACd,CACAX,OAAAA,EAAK,SAASgB,EAAYpB,CAAM,EAEhCoB,EAAW,UAAU,KAAO,UAAgB,CAC1C,GAAI,CACF,IAAID,EAAYL,EAAQ,CACtB,OAAQ,KAAK,OACb,QAAS,KAAK,QAAQ,OACtB,OAAQ,KAAK,OAAO,OACpB,SAAU,KAAK,QACrB,CAAK,EACD,YAAK,KAAK,OAAQK,CAAS,EAC3B,KAAK,KAAK,OAAQA,CAAS,EAC3B,KAAK,KAAK,KAAK,EACf,KAAK,SAAW,GACTA,CACR,OAAQI,EAAG,CACV,KAAK,SAAW,GAChB,KAAK,KAAK,QAASA,CAAC,EACpB,KAAK,KAAK,OAAO,CACrB,CACC,EAEDH,EAAW,KAAON,EAElBU,EAAiBJ","x_google_ignoreList":[0]}