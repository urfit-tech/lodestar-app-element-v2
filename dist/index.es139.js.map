{"version":3,"file":"index.es139.js","sources":["../node_modules/jws/lib/sign-stream.js"],"sourcesContent":["/*global module*/\nvar Buffer = require('safe-buffer').Buffer;\nvar DataStream = require('./data-stream');\nvar jwa = require('jwa');\nvar Stream = require('stream');\nvar toString = require('./tostring');\nvar util = require('util');\n\nfunction base64url(string, encoding) {\n  return Buffer\n    .from(string, encoding)\n    .toString('base64')\n    .replace(/=/g, '')\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_');\n}\n\nfunction jwsSecuredInput(header, payload, encoding) {\n  encoding = encoding || 'utf8';\n  var encodedHeader = base64url(toString(header), 'binary');\n  var encodedPayload = base64url(toString(payload), encoding);\n  return util.format('%s.%s', encodedHeader, encodedPayload);\n}\n\nfunction jwsSign(opts) {\n  var header = opts.header;\n  var payload = opts.payload;\n  var secretOrKey = opts.secret || opts.privateKey;\n  var encoding = opts.encoding;\n  var algo = jwa(header.alg);\n  var securedInput = jwsSecuredInput(header, payload, encoding);\n  var signature = algo.sign(securedInput, secretOrKey);\n  return util.format('%s.%s', securedInput, signature);\n}\n\nfunction SignStream(opts) {\n  var secret = opts.secret||opts.privateKey||opts.key;\n  var secretStream = new DataStream(secret);\n  this.readable = true;\n  this.header = opts.header;\n  this.encoding = opts.encoding;\n  this.secret = this.privateKey = this.key = secretStream;\n  this.payload = new DataStream(opts.payload);\n  this.secret.once('close', function () {\n    if (!this.payload.writable && this.readable)\n      this.sign();\n  }.bind(this));\n\n  this.payload.once('close', function () {\n    if (!this.secret.writable && this.readable)\n      this.sign();\n  }.bind(this));\n}\nutil.inherits(SignStream, Stream);\n\nSignStream.prototype.sign = function sign() {\n  try {\n    var signature = jwsSign({\n      header: this.header,\n      payload: this.payload.buffer,\n      secret: this.secret.buffer,\n      encoding: this.encoding\n    });\n    this.emit('done', signature);\n    this.emit('data', signature);\n    this.emit('end');\n    this.readable = false;\n    return signature;\n  } catch (e) {\n    this.readable = false;\n    this.emit('error', e);\n    this.emit('close');\n  }\n};\n\nSignStream.sign = jwsSign;\n\nmodule.exports = SignStream;\n"],"names":["Buffer","require$$0","DataStream","require$$1","jwa","require$$2","Stream","require$$3","toString","require$$4","util","require$$5","base64url","string","encoding","jwsSecuredInput","header","payload","encodedHeader","encodedPayload","jwsSign","opts","secretOrKey","algo","securedInput","signature","SignStream","secret","secretStream","e","signStream"],"mappings":";;;;;;;;;;AACA,MAAIA,IAASC,EAAsB,EAAC,QAChCC,IAAaC,EAAwB,GACrCC,IAAMC,EAAc,GACpBC,IAASC,GACTC,IAAWC,EAAqB,GAChCC,IAAOC,EAAe;AAE1B,WAASC,EAAUC,GAAQC,GAAU;AACnC,WAAOd,EACJ,KAAKa,GAAQC,CAAQ,EACrB,SAAS,QAAQ,EACjB,QAAQ,MAAM,EAAE,EAChB,QAAQ,OAAO,GAAG,EAClB,QAAQ,OAAO,GAAG;AAAA,EACvB;AAEA,WAASC,EAAgBC,GAAQC,GAASH,GAAU;AAClD,IAAAA,IAAWA,KAAY;AACvB,QAAII,IAAgBN,EAAUJ,EAASQ,CAAM,GAAG,QAAQ,GACpDG,IAAiBP,EAAUJ,EAASS,CAAO,GAAGH,CAAQ;AAC1D,WAAOJ,EAAK,OAAO,SAASQ,GAAeC,CAAc;AAAA,EAC3D;AAEA,WAASC,EAAQC,GAAM;AACrB,QAAIL,IAASK,EAAK,QACdJ,IAAUI,EAAK,SACfC,IAAcD,EAAK,UAAUA,EAAK,YAClCP,IAAWO,EAAK,UAChBE,IAAOnB,EAAIY,EAAO,GAAG,GACrBQ,IAAeT,EAAgBC,GAAQC,GAASH,CAAQ,GACxDW,IAAYF,EAAK,KAAKC,GAAcF,CAAW;AACnD,WAAOZ,EAAK,OAAO,SAASc,GAAcC,CAAS;AAAA,EACrD;AAEA,WAASC,EAAWL,GAAM;AACxB,QAAIM,IAASN,EAAK,UAAQA,EAAK,cAAYA,EAAK,KAC5CO,IAAe,IAAI1B,EAAWyB,CAAM;AACxC,SAAK,WAAW,IAChB,KAAK,SAASN,EAAK,QACnB,KAAK,WAAWA,EAAK,UACrB,KAAK,SAAS,KAAK,aAAa,KAAK,MAAMO,GAC3C,KAAK,UAAU,IAAI1B,EAAWmB,EAAK,OAAO,GAC1C,KAAK,OAAO,KAAK,SAAS,WAAY;AACpC,MAAI,CAAC,KAAK,QAAQ,YAAY,KAAK,YACjC,KAAK,KAAM;AAAA,IACjB,EAAI,KAAK,IAAI,CAAC,GAEZ,KAAK,QAAQ,KAAK,SAAS,WAAY;AACrC,MAAI,CAAC,KAAK,OAAO,YAAY,KAAK,YAChC,KAAK,KAAM;AAAA,IACjB,EAAI,KAAK,IAAI,CAAC;AAAA,EACd;AACA,SAAAX,EAAK,SAASgB,GAAYpB,CAAM,GAEhCoB,EAAW,UAAU,OAAO,WAAgB;AAC1C,QAAI;AACF,UAAID,IAAYL,EAAQ;AAAA,QACtB,QAAQ,KAAK;AAAA,QACb,SAAS,KAAK,QAAQ;AAAA,QACtB,QAAQ,KAAK,OAAO;AAAA,QACpB,UAAU,KAAK;AAAA,MACrB,CAAK;AACD,kBAAK,KAAK,QAAQK,CAAS,GAC3B,KAAK,KAAK,QAAQA,CAAS,GAC3B,KAAK,KAAK,KAAK,GACf,KAAK,WAAW,IACTA;AAAA,IACR,SAAQI,GAAG;AACV,WAAK,WAAW,IAChB,KAAK,KAAK,SAASA,CAAC,GACpB,KAAK,KAAK,OAAO;AAAA,IACrB;AAAA,EACC,GAEDH,EAAW,OAAON,GAElBU,IAAiBJ;;","x_google_ignoreList":[0]}