"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const A=require("./index.cjs68.js"),K=require("./index.cjs70.js"),D=require("./index.cjs69.js"),H=require("./index.cjs67.js"),O=require("./index.cjs72.js"),W=require("./index.cjs73.js"),L=require("./index.cjs74.js"),M=require("./index.cjs75.js"),U=require("./index.cjs76.js"),G=require("./index.cjs77.js"),J=require("./index.cjs78.js"),C=require("./index.cjs71.js");var l,E;function F(){if(E)return l;E=1;const g=A.__require(),q=K.__require(),x=D.__require(),y=H.__require(),j=O.__require(),d=W.__require(),h=L.__require(),c=M.__require(),b=U.__require(),a=G.__require(),V=J.__require(),{KeyObject:I,createSecretKey:B,createPrivateKey:$}=C.default,p=["RS256","RS384","RS512","ES256","ES384","ES512","HS256","HS384","HS512","none"];q&&p.splice(3,0,"PS256","PS384","PS512");const P={expiresIn:{isValid:function(e){return h(e)||a(e)&&e},message:'"expiresIn" should be a number of seconds or string representing a timespan'},notBefore:{isValid:function(e){return h(e)||a(e)&&e},message:'"notBefore" should be a number of seconds or string representing a timespan'},audience:{isValid:function(e){return a(e)||Array.isArray(e)},message:'"audience" must be a string or array'},algorithm:{isValid:j.bind(null,p),message:'"algorithm" must be a valid string enum value'},header:{isValid:b,message:'"header" must be an object'},encoding:{isValid:a,message:'"encoding" must be a string'},issuer:{isValid:a,message:'"issuer" must be a string'},subject:{isValid:a,message:'"subject" must be a string'},jwtid:{isValid:a,message:'"jwtid" must be a string'},noTimestamp:{isValid:d,message:'"noTimestamp" must be a boolean'},keyid:{isValid:a,message:'"keyid" must be a string'},mutatePayload:{isValid:d,message:'"mutatePayload" must be a boolean'},allowInsecureKeySizes:{isValid:d,message:'"allowInsecureKeySizes" must be a boolean'},allowInvalidAsymmetricKeyTypes:{isValid:d,message:'"allowInvalidAsymmetricKeyTypes" must be a boolean'}},T={iat:{isValid:c,message:'"iat" should be a number of seconds'},exp:{isValid:c,message:'"exp" should be a number of seconds'},nbf:{isValid:c,message:'"nbf" should be a number of seconds'}};function _(e,i,r,o){if(!b(r))throw new Error('Expected "'+o+'" to be a plain object.');Object.keys(r).forEach(function(u){const t=e[u];if(!t){if(!i)throw new Error('"'+u+'" is not allowed in "'+o+'"');return}if(!t.isValid(r[u]))throw new Error(t.message)})}function v(e){return _(P,!1,e,"options")}function R(e){return _(T,!0,e,"payload")}const w={audience:"aud",issuer:"iss",subject:"sub",jwtid:"jti"},z=["expiresIn","notBefore","noTimestamp","audience","issuer","subject","jwtid"];return l=function(e,i,r,o){typeof r=="function"?(o=r,r={}):r=r||{};const u=typeof e=="object"&&!Buffer.isBuffer(e),t=Object.assign({alg:r.algorithm||"HS256",typ:u?"JWT":void 0,kid:r.keyid},r.header);function s(n){if(o)return o(n);throw n}if(!i&&r.algorithm!=="none")return s(new Error("secretOrPrivateKey must have a value"));if(i!=null&&!(i instanceof I))try{i=$(i)}catch{try{i=B(typeof i=="string"?Buffer.from(i):i)}catch{return s(new Error("secretOrPrivateKey is not valid key material"))}}if(t.alg.startsWith("HS")&&i.type!=="secret")return s(new Error(`secretOrPrivateKey must be a symmetric key when using ${t.alg}`));if(/^(?:RS|PS|ES)/.test(t.alg)){if(i.type!=="private")return s(new Error(`secretOrPrivateKey must be an asymmetric key when using ${t.alg}`));if(!r.allowInsecureKeySizes&&!t.alg.startsWith("ES")&&i.asymmetricKeyDetails!==void 0&&i.asymmetricKeyDetails.modulusLength<2048)return s(new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${t.alg}`))}if(typeof e>"u")return s(new Error("payload is required"));if(u){try{R(e)}catch(n){return s(n)}r.mutatePayload||(e=Object.assign({},e))}else{const n=z.filter(function(f){return typeof r[f]<"u"});if(n.length>0)return s(new Error("invalid "+n.join(",")+" option for "+typeof e+" payload"))}if(typeof e.exp<"u"&&typeof r.expiresIn<"u")return s(new Error('Bad "options.expiresIn" option the payload already has an "exp" property.'));if(typeof e.nbf<"u"&&typeof r.notBefore<"u")return s(new Error('Bad "options.notBefore" option the payload already has an "nbf" property.'));try{v(r)}catch(n){return s(n)}if(!r.allowInvalidAsymmetricKeyTypes)try{x(t.alg,i)}catch(n){return s(n)}const m=e.iat||Math.floor(Date.now()/1e3);if(r.noTimestamp?delete e.iat:u&&(e.iat=m),typeof r.notBefore<"u"){try{e.nbf=g(r.notBefore,m)}catch(n){return s(n)}if(typeof e.nbf>"u")return s(new Error('"notBefore" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}if(typeof r.expiresIn<"u"&&typeof e=="object"){try{e.exp=g(r.expiresIn,m)}catch(n){return s(n)}if(typeof e.exp>"u")return s(new Error('"expiresIn" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}Object.keys(w).forEach(function(n){const f=w[n];if(typeof r[n]<"u"){if(typeof e[f]<"u")return s(new Error('Bad "options.'+n+'" option. The payload already has an "'+f+'" property.'));e[f]=r[n]}});const S=r.encoding||"utf8";if(typeof o=="function")o=o&&V(o),y.createSign({header:t,privateKey:i,payload:e,encoding:S}).once("error",o).once("done",function(n){if(!r.allowInsecureKeySizes&&/^(?:RS|PS)/.test(t.alg)&&n.length<256)return o(new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${t.alg}`));o(null,n)});else{let n=y.sign({header:t,payload:e,secret:i,encoding:S});if(!r.allowInsecureKeySizes&&/^(?:RS|PS)/.test(t.alg)&&n.length<256)throw new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${t.alg}`);return n}},l}exports.__require=F;
//# sourceMappingURL=index.cjs51.js.map
